<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CJA Professional Demo Store</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<script src="https://assets.adobedtm.com/e72b4113c11a/86ee37b431d3/launch-bd7ab64d003c.min.js" async></script>

<script>
window.digitalData = {
  event: "",
  product: {
    id: "",
    name: "",
    price: 0,
    quantity: 1
  }
};
</script>

<style>
/* unchanged CSS */
</style>
</head>

<body>

<header>
  <h1>CJA Demo Store</h1>
</header>

<div class="container">

  <div class="products" id="products"></div>

  <div class="cart">
    <h2>Shopping Cart</h2>
    <div id="cartItems">Cart is empty</div>
    <div class="total" id="total">Total: ‚Çπ0</div>
    <button class="checkout" onclick="placeOrder()">Place Order</button>
  </div>

</div>

<footer>¬© 2026 ‚Ä¢ CJA Portfolio Project</footer>

<script>
const products=[
 {id:1,name:'iPhone 15',price:75000,rating:4.8},
 {id:2,name:'Sony WH-1000XM5',price:30000,rating:4.6},
 {id:3,name:'MacBook Air M2',price:115000,rating:4.9},
 {id:4,name:'Samsung Galaxy Watch',price:28000,rating:4.5},
 {id:5,name:'iPad Air',price:55000,rating:4.7}
];

let cart=[];

// ---------- PRODUCT VIEW ----------
function fireProductView(p){
  window.digitalData.event = "product_view";
  window.digitalData.product.id = p.id;
  window.digitalData.product.name = p.name;
  window.digitalData.product.price = p.price;
  window.digitalData.product.quantity = 1;
  console.log("CJA ‚Üí product_view",window.digitalData);
}

// ---------- RENDER PRODUCTS ----------
function renderProducts(){
 let html='';
 products.forEach(p=>{
   html+=`
   <div class="card">
     <div class="product-img" onclick='fireProductView(${JSON.stringify(p)})'>${p.name}</div>
     <div class="price">‚Çπ${p.price}</div>
     <div class="rating">‚≠ê ${p.rating}</div>
     <button onclick="addToCart(${p.id})">Add To Cart</button>
   </div>`;
 });
 document.getElementById('products').innerHTML=html;
}

// ---------- ADD TO CART ----------
function addToCart(id) {
  let product = products.find(p => p.id === id);
  cart.push(product);
  updateCart();

  window.digitalData.event = "add_to_cart";
  window.digitalData.product.name = product.name;
  window.digitalData.product.price = product.price;
  window.digitalData.product.quantity = 1;

  console.log("CJA ‚Üí add_to_cart", window.digitalData);
}

// ---------- VIEW CART ----------
function updateCart(){
 if(cart.length===0){
   document.getElementById('cartItems').innerHTML='Cart is empty';
   document.getElementById('total').innerText='Total: ‚Çπ0';
   return;
 }

 window.digitalData.event = "view_cart";
 console.log("CJA ‚Üí view_cart");

 let html=''; let total=0;
 cart.forEach(p=>{
   total+=p.price;
   html+=`<div class="cart-item"><span>${p.name}</span><span>‚Çπ${p.price}</span></div>`;
 });
 document.getElementById('cartItems').innerHTML=html;
 document.getElementById('total').innerText='Total: ‚Çπ'+total;
}

// ---------- CHECKOUT + PAYMENT + PURCHASE ----------
function placeOrder() {
  if (cart.length === 0) {
    alert('Cart is empty');
    return;
  }

  window.digitalData.event = "checkout_start";
  console.log("CJA ‚Üí checkout_start");

  window.digitalData.event = "payment_start";
  console.log("CJA ‚Üí payment_start");

  window.lastPurchasedCart = JSON.parse(JSON.stringify(cart));

  setTimeout(() => {
    document.dispatchEvent(new CustomEvent("cja_purchase"));
  }, 200);

  window.digitalData.event = "order_success";
  console.log("CJA ‚Üí order_success");

  alert('üéâ Order placed successfully!');

  cart = [];
  updateCart();
}

// ---------- CART ABANDON ----------
window.addEventListener("beforeunload", function () {
  if (cart.length > 0) {
    window.digitalData.event = "cart_abandon";
    console.log("CJA ‚Üí cart_abandon");
  }
});

renderProducts();
</script>

</body>
</html>
